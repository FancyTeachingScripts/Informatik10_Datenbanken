\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sty/4_Skript}[]

\definecolor{colA_default}{rgb}{0.98, 0.553, 0.271}
\definecolor{colB_default}{rgb}{0.024, 0.694, 0.906}
\definecolor{colC_default}{rgb}{0.325, 0.820, 0.443}

\definecolor{colA_mtg}{rgb}{0.957, 0.616, 0}
\definecolor{colB_mtg}{rgb}{0, 0.412, 0.698}
\definecolor{colC_mtg}{rgb}{0.408, 0.686, 0.133}

\definecolor{colA_derksen}{rgb}{0.882, 0.682, 0.224}
\definecolor{colB_derksen}{rgb}{0, 0.412, 0.698}
\definecolor{colC_derksen}{rgb}{0.408, 0.686, 0.133}

\renewcommand{\emphColor}[2]{{\color{#1} \emph{#2}}}
\renewcommand{\emphColA}[1]{\emphColor{colA}{#1}}
\renewcommand{\emphColB}[1]{\emphColor{colB}{#1}}
\renewcommand{\emphColC}[1]{\emphColor{colC}{#1}}


\newcommand{\marksectionstart}{%
  \begin{tikzpicture}[remember picture, overlay]
    \coordinate (sectionstart) at (0,0);
  \end{tikzpicture}%
}


\newcommand{\QrcodeBeamer}[1]{
    \begin{tikzpicture}[remember picture,overlay]
        \node[anchor=north east] 
            at ([xshift=-0.3cm, yshift=0.35cm]current page.north east |- sectionstart) 
            {\fcolorbox{white}{black}{\qrcode[hyperlink, height=2.5cm, level=H]{https://#1}}};
    \end{tikzpicture}%
}

\newcommand{\QrcodeScript}[4]{
    \begin{tikzpicture}[remember picture, overlay]
        \node[anchor=north east] 
            at ([xshift=#2, yshift=#3]current page.north east |- sectionstart) 
            {\qrcode[hyperlink, height=#1]{https://#4}};
    \end{tikzpicture}%
}

\newcommand{\Qrcode}[4]{
    \ifbeamer
        \QrcodeBeamer{#4}
    \else
        \QrcodeScript{#1}{#2}{#3}{#4}
    \fi
}


% #1 <height>
% #2 [xshift right]
% #3 [yshift up]
% #4 {url without https://}
\NewDocumentCommand{\UrlAndCode}{ D<>{1cm} O{-1cm} O{0.5cm} m}{
    \href{https://#4}{\url{#4}}
    \ifqrcodes
        \iftoggle{preview}{}{
            \Qrcode{#1}{#2}{#3}{#4}
        }
    \fi
}


\newcommand{\AttachVlgSkript}[2]{
    \begin{tikzpicture}[remember picture, overlay]
        \node[anchor=north east] 
        at ([xshift=-2.5cm, yshift=0.25cm]current page.north east |- sectionstart) 
        {\textattachfile[color=\TFarbe]{#2}{Vorlage \large #1} };
  \end{tikzpicture}%
}

\newcommand{\AttachVlgBeamer}[2]{
    \begin{tikzpicture}[remember picture,overlay]
        \node[anchor=north east] 
        at ([xshift=-2cm, yshift=1.2cm]current page.north east |- sectionstart) 
        {\textattachfile[color=\TFarbe]{#2}{Vorlage \LARGE #1}};
    \end{tikzpicture}%
}

\newcommand{\AttachLsgSkript}[2]{
    \begin{tikzpicture}[remember picture, overlay]
        \ifloesung 
            \node[anchor=north east] 
            at ([xshift=-2.5cm, yshift=0.25cm]current page.north east |- sectionstart) 
            {\textattachfile[color=\LFarbe]{#2}{Lsg \large #1}};
        \fi
    \end{tikzpicture}%
}

\newcommand{\AttachLsgBeamer}[2]{
    \begin{tikzpicture}[remember picture,overlay]
        \node[anchor=north east] 
        at ([xshift=-2cm, yshift=1.2cm]current page.north east |- sectionstart) 
        {\textattachfile[color=\LFarbe]{#2}{Lsg \LARGE #1}};
    \end{tikzpicture}%
}

\newcommand{\AttachVlgLsgSkript}[3]{
    \begin{tikzpicture}[remember picture, overlay]
        \node[anchor=north east] 
        at ([xshift=-2.5cm, yshift=0.25cm]current page.north east |- sectionstart) 
        {\textattachfile[color=\TFarbe]{#2}{Vorlage \large #1} };
        \ifloesung 
            \node[anchor=north east] 
            at ([xshift=-4.5cm, yshift=0.25cm]current page.north east |- sectionstart) 
            {\textattachfile[color=\LFarbe]{#3}{Lsg \large #1}};
        \fi
    \end{tikzpicture}%
}
\newcommand{\AttachVlgLsgBeamer}[3]{
    \begin{tikzpicture}[remember picture,overlay]
        \node[anchor=north east] at ([xshift=-2cm, yshift=1.2cm]current page.north east |- sectionstart) 
        {\textattachfile[color=\TFarbe]{#2}{Vorlage \LARGE #1}};
        \ifloesung
            \node[anchor=north east] at ([xshift=-4.25cm, yshift=1.2cm]current page.north east |- sectionstart) 
            {\textattachfile[color=\LFarbe]{#3}{Lsg \LARGE #1} };
        \fi
    \end{tikzpicture}%
}


\newcommand{\AttachVlgInt}[2]{
        \ifbeamer
            \AttachVlgBeamer{#1}{#2}
        \else
            \AttachVlgSkript{#1}{#2}
        \fi
}
\newcommand{\AttachLsgInt}[2]{
    \ifbeamer
        \AttachLsgBeamer{#1}{#2}
    \else
        \AttachLsgSkript{#1}{#2}
    \fi
}
\newcommand{\AttachVlgLsgInt}[3]{
    \ifbeamer
        \AttachVlgLsgBeamer{#1}{#2}{#3}
    \else
        \AttachVlgLsgSkript{#1}{#2}{#3}
    \fi
}


\newcommand{\AttachVlg}[2]{
    \ifattachments
        \iftoggle{preview}{}{
            \AttachVlgInt{#1}{#2}
        }
    \fi
}
\newcommand{\AttachLsg}[2]{
    \ifattachments
        \iftoggle{preview}{}{
            \AttachLsgInt{#1}{#2}
        }
    \fi
}
\newcommand{\AttachVlgLsg}[3]{
    \ifattachments
        \iftoggle{preview}{}{
            \AttachVlgLsgInt{#1}{#2}{#3}
        }
    \fi
}


\newcommand{\mysession}[2]{
    \ifbeamer
        \ifeinzelstunden
        \ZoomSection % \ZoomSection or \Zoom (without creating a section)
        {{\color{colC}#1}} % Zoom (and Section) title
        {false} % true/false: Repeat summary Zoom after slides 
        {true} % true/false: Show previous (since last summary zoom)
        {
            #2
        }
        \else
            \setcounter{lastsecstart}{\value{sectionstart}}
            \setcounter{sectionstart}{\value{frametotal}}
            #2
            \togglefalse{preview}
            \recitesection    
        \fi
    \else
    #2
    \fi
}

\newcommand{\mysection}[4]{%
  \ifbeamer
    
      \subsection{#1}
    \begin{frame}
    \setcounter{lsgcount}{1}
      \frametitle{#1}
          \begin{tikzpicture}[remember picture,overlay]
                \node[anchor=north east] at (current page.north east) {
                  \includegraphics[height=16pt, color=#3]{#2}
                };
          \end{tikzpicture}
      #4
    \end{frame}
  \else
    %\begin{minipage}[t]{\textwidth} \vspace{0pt}
        \section*{#1}
    
        \flushright
        
        \vspace{-30pt}
    
        \includegraphics[height=25pt, color=#3]{#2}
        \flushleft
        
        #4
    %\end{minipage}
  \fi
}

\newcommand{\HefteintragBeamer}[4]{ 
    \ifeinzelstunden
        \subsection{\color{colA} #2}
    \else
        \section{\color{colA} #2}
    \fi
    \definesframe{#1}{
    %\begin{frame}
        \setcounter{lsgcount}{1}
        \color{\TFarbe}
        \linespread{#1}
        \iftimer
          \ifnum\numexpr#4>0 \relax 
              \timer{#4}
              \setcounter{lsgcount}{#4}
              \stepcounter{lsgcount}
              \stepcounter{lsgcount}
          \fi
        \fi
        \begin{tcolorbox}[
            breakable,
            enhanced,
            title=#2,
            opacityframe=1,
            fontupper=\color{\TFarbe},
            opacityback=1,
            colback=colA!10!black,
            colframe=colA,
            fonttitle=\bfseries\Large,
            overlay={\node[anchor=north east,outer sep=-1pt]  at (frame.north east) {\includegraphics[height=15pt]{sty/img/pen_white.pdf}};}
        ]
        \marksectionstart
            #3
        \end{tcolorbox}
    %\end{frame}
    }
}

\newcommand{\HefteintragSkript}[3]{
    \vspace{0.2cm}
    \begin{tcolorbox}[colframe=colA]
        \color{colA}\section{\color{colA} #2} \color{black}
        \linespread{#1}
        \flushright
        \vspace{-30pt}  
        \includegraphics[height=25pt]{sty/img/pen_\theme_colA.pdf}

        \vspace{-35pt}  
        \marksectionstart
        \large
        \flushleft
        #3
    \end{tcolorbox}
}

\renewcommand{\Hefteintrag}[4][0]{
    \ifbeamer
        \HefteintragBeamer{#2}{#3}{#4}{#1}
    \else
        \HefteintragSkript{#2}{#3}{#4}
    \fi
}


\newcommand{\AufgabeSkript}[2]{
    \vspace{0.3cm}
    \marksectionstart
    \begin{minipage}[t]{\textwidth} 
        \vspace{0pt}
        \section*{\hspace{30pt} \color{colB} #1}
        \vspace{-40pt}
        \includegraphics[height=30pt]{sty/img/finger_\theme_colB.pdf}
        
        \vspace{0.2cm}
        #2
    \end{minipage}
}
 
\newcommand{\AufgabeBeamer}[3]{
    \ifeinzelstunden
        \subsection{\color{colB} #1}
    \else
        \section{\color{colB} #1}
    \fi
    \definesframe{#1}{
    %\begin{frame}
        \setcounter{lsgcount}{1}
        \iftimer
        
        \typeout{HI1}
          \ifnum\numexpr#3>0 \relax 
          
        \typeout{HI2}
              \timer{#3}
        \typeout{HI3}
              \setcounter{lsgcount}{#3}
              \stepcounter{lsgcount}
              \stepcounter{lsgcount}
          \fi
        \fi
        %\marksectionstart
        \begin{tcolorbox}[%
            breakable,
            enhanced,
            title= \strut {\color{colB}#1},
            opacityframe=1,
            fontupper=\color{\TFarbe},
            opacityback=1,
            colback=colB!7!black,
            colframe=lightgray,
            fonttitle=\bfseries\Large,
            overlay={\node[anchor=north east,outer sep=-1pt] at (frame.north east) {\includegraphics[height=22pt]{sty/img/finger_\theme_colB.pdf}};}
        ]
          \marksectionstart
          #2
        \end{tcolorbox}
    }
}

\newcommand{\UnterAufgabeSkript}[1]{
    \begin{minipage}[t]{\textwidth} 
        \vspace{0.2cm}
        #1
    \end{minipage}
}

\newcommand{\UnterAufgabeBeamer}[3]{
    %\subsection{\color{colB} #1}
    \definesframe[false]{#1}{
    %\begin{frame}
        \setcounter{lsgcount}{1}
        \iftimer
          \ifnum\numexpr#3>0 \relax 
              \timer{#3}
              \setcounter{lsgcount}{#3}
              \stepcounter{lsgcount}
              \stepcounter{lsgcount}
          \fi
        \fi
        %\marksectionstart
        \begin{tcolorbox}[%
            breakable,
            enhanced,
            title= \strut {\color{colB}#1},
            opacityframe=1,
            fontupper=\color{\TFarbe},
            opacityback=1,
            colback=colB!7!black,
            colframe=lightgray,
            fonttitle=\bfseries\Large,
            overlay={\node[anchor=north east,outer sep=-1pt] at (frame.north east) {\includegraphics[height=22pt]{sty/img/finger_\theme_colB.pdf}};}
        ]
          \marksectionstart
          #2
        \end{tcolorbox}
    }

}


\renewcommand{\Aufgabe}[3][0]{
    \ifbeamer
        \AufgabeBeamer{#2}{#3}{#1}
    \else
        \AufgabeSkript{#2}{#3}
    \fi
}
\renewcommand{\UnterAufgabe}[3][0]{
    \ifbeamer
        \UnterAufgabeBeamer{#2}{#3}{#1}
    \else
        \UnterAufgabeSkript{#3}
    \fi
}


% #1: Width left
% #2: Width right
% #3: Vertical alignment
% #4: Content left
% #5: Content right
\newcommand{\doppelseite}[5]{%
  \begin{minipage}[#3]{#1\textwidth} \vspace{0pt}
    #4
  \end{minipage}
  \hfill
  \begin{minipage}[#3]{#2\textwidth} \vspace{0pt}
    #5
  \end{minipage}
}

	
\newcommand\maketabularrow[1]{%
  \newcounter{colnum}
  \setcounter{colnum}{0}%
  \whileboolexpr
    { test {\ifnumcomp{\value{colnum}}{<}{#1}} }%
    {\stepcounter{colnum}\aPunkte(\value{colnum})~~~&}
}