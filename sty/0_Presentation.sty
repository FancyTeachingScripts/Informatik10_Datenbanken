\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sty/0_Presentation}[]


\definecolor{lcolor}{RGB}{0, 255, 255}
\renewcommand{\LFarbe}{lcolor}
\renewcommand{\TFarbe}{white}


\usetheme{moloch}
\usecolortheme{owl}

\newcounter{prevsection}
\setcounter{prevsection}{0}
\newcommand{\prevsection}{0}

\geometry{paperwidth=21cm, paperheight=11.81cm}
\setbeamersize{text margin left=0.3cm, text margin right=0.3cm}
\setbeamertemplate{page number in head/foot}{}

% \setbeamertemplate{navigation symbols}{
%     \ifaufraeumen
%         \hyperlink{end}{\beamerskipbutton{Aufräumen!}}
%     \fi
% }

% \setbeamertemplate{footline}{%
%     \vspace*{\fill} % push to the bottom
%     \raisebox{-0.28cm}{%
%         \ifaufraeumen
%             \hyperlink{end}{\beamerskipbutton{Aufräumen!}}
%         \fi
%     }%
% }

\setbeamertemplate{background}{%
    \begin{tikzpicture}[remember picture,overlay]
        \ifaufraeumen
            % Place 0.3cm from the bottom, centered horizontally
            \node[yshift=-0.12cm, xshift=-0.1cm,anchor=south west] at (current page.south west) {%
                \hyperlink{end}{\beamerskipbutton{Aufräumen!}}%
            };
        \fi
    \end{tikzpicture}%
}


%\setbeamertemplate{page number in head/foot}{}
\setbeamersize{text margin left=0.3cm, text margin right=0.3cm}

\LoesungTitleExtension{}

\AtBeginSection[]{
    \ifeinzelstunden
          \begin{frame}{Outline}%: \Fachtext~\Klassetext~-~\Titeltext}
            % \begin{columns}[t]
            %   \begin{column}{.49\textwidth}
            %     \tableofcontents[sections={1-4},subsectionstyle=hide]
            %   \end{column}
            %   \begin{column}{.49\textwidth}
            %     \tableofcontents[sections={5-7},subsectionstyle=hide]
            %   \end{column}
            % \end{columns}
            
            {\tiny\color{black}Outline}
            \begin{minipage}{\textwidth}
            \begin{multicols}{2}
                \tableofcontents[currentsection,subsectionstyle=hide]
            \end{multicols}
                
            \end{minipage}
          \end{frame}

        % REMOVED FOR DUMMARY ZOOM
        % \begin{frame}\LARGE
        
        %     \vspace{1cm}
        %     \begin{columns}[T] % align columns
        %         \begin{column}{.5\textwidth}\centering  \textbf{Letztes Mal}\\\vspace{1cm} \tableofcontents[sections=\value{prevsection}, sectionstyle=hide, subsectionstyle=show/show/show]\end{column}%
        %         \hfill%
        %         \begin{column}{.5\textwidth}\centering  \textbf{Heute}\\\vspace{1cm} \tableofcontents[sections=\thesection, sectionstyle=hide, subsectionstyle=show/show/show]\end{column}%
        %     \end{columns}
        % \end{frame} 
        \setcounter{prevsection}{\thesection}
        %\tableofcontents[pausesections, subsectionstyle=show/shaded]
    \fi
    \normalsize
    
}

\AtBeginDocument{
  \begin{frame}
    \centering
    \includegraphics[height=0.5\paperheight]{sty/img/logo_\theme.pdf}

    \vspace{0.5cm}
    {\huge \Fachtext~\Klassetext~-~\Titeltext}

    \ifletzterstand
        \vspace{0.2cm}
        {\normalsize \color{gray} aktualisiert: \today}
    \fi
    
  \end{frame}
  
  \begin{frame}{\Fachtext~\Klassetext~-~\Titeltext}
  \raggedcolumns
  \begin{multicols}{2}
    \tableofcontents[subsectionstyle=show]
  \end{multicols}
  
    % \begin{columns}[t]
    %   \begin{column}{.49\textwidth}
    %     \tableofcontents[sections={1-4},subsectionstyle=show]
    %   \end{column}
    %   \begin{column}{.49\textwidth}
    %     \tableofcontents[sections={5-9},subsectionstyle=show]
    %   \end{column}
    % \end{columns}
  \end{frame}
  

  \Content
}

\AtEndDocument{
    \ifaufraeumen
        \EndOfSession{25}
    \fi

}

\makeatletter
\defbeamertemplate{section in toc}{centered}{%
\centering\inserttocsection\par }
\defbeamertemplate{subsection in toc}{centered}{%
\centering\hspace*{1em}\inserttocsubsection\par }
\patchcmd{\beamer@sectionintoc}
{\vskip1.0em}
{\vskip20pt} % ersetzt Standardabstand mit 4pt
{}{}
\makeatother
\setbeamertemplate{section in toc}[centered]
\setbeamertemplate{subsection in toc}[centered]

\ifeinzelstunden
\setbeamerfont{section in toc}{size=\LARGE}
\else
\setbeamerfont{section in toc}{size=\normalsize}
\fi
\setbeamerfont{subsection in toc}{size=\normalsize}
\setbeamercolor{section in toc}{fg=green}


% Farben
\setbeamercolor{section in toc}{fg=green}

% 4pt Abstand vor jeder Section in toc (Template überschreiben)
\setbeamertemplate{section in toc}{%
  \vskip8pt %
  \leavevmode\leftskip=2em %
  \usebeamerfont*{section in toc} %
  \usebeamercolor[fg]{section in toc} %
  \centering\inserttocsection\par %
}


% optional: Template für Subsections
\setbeamertemplate{subsection in toc}{%
  \leavevmode\leftskip=3em %
  \usebeamerfont*{subsection in toc} %
  \usebeamercolor[fg]{subsection in toc} %
  \centering\hspace*{1em}\inserttocsubsection\par %
}


\renewcommand{\timer}[1]{
    \iftimer
        \iftoggle{preview}{
            }{%
            \begin{tikzpicture}[remember picture, overlay]
                \pgfmathsetmacro{\total}{#1} % total number of blocks (steps)
                \pgfmathsetmacro{\lastTimer}{\total + 1} % total number of blocks (steps)
                \pgfmathsetmacro{\lastSlide}{\total + 2} % total number of blocks (steps)
                \pgfmathsetmacro{\blockwidth}{\paperwidth / \total}
                
                
                \only<1>{%
                    \fill[darkgray!120] (current page.south west) rectangle ++(\paperwidth, 0.31cm);
                    \node[text width=2.1cm] at ([yshift=4.5pt]current page.south east) {\fontsize{8}{8}\selectfont\total~Min.};
                }
        
                \foreach \i in {2,...,\lastSlide} {
                    \pgfmathsetmacro{\x}{(\i-2)*\blockwidth}
                    \pgfmathsetmacro{\gWidth}{(\lastSlide - \i)*\blockwidth}
                    \pgfmathtruncatemacro{\timeleft}{\lastSlide - \i}
                    \only<\i>{%
                        \ifthenelse{\i < \lastSlide}{
                            \fill[left color = green,right color = orange] ([xshift=0cm ]current page.south west) rectangle ++(\paperwidth, 0.3cm);
                            \fill[darkgray!100] ([xshift=\x ]current page.south west) rectangle ++(\paperwidth, 0.31cm);
                            \node[text width=2.1cm] at ([yshift=4.5pt]current page.south east) {\fontsize{8}{8}\selectfont \timeleft~Min.};
                        }{
                            % \fill[colB] ([xshift=0pt ]current page.south west) rectangle ++(\paperwidth, 0.31cm);
                            % \node[text width=\paperwidth] at ([yshift=4.5pt]current page.south east) {\centering \fontsize{8}{8}\selectfont FERTIG};
                        }
                    }
                    \ifthenelse{\i < \lastSlide}{\transduration<\i>{60}}{}
                }
            \end{tikzpicture}%
            }
    \fi
}


\newcommand{\fullframe}[1]{
\makebox[\linewidth][c]{%
  \begin{minipage}{\paperwidth}
    \raggedright#1
  \end{minipage}%
  }%
}


\renewcommand{\EndOfSession}[1]{
    \begin{frame}[plain,label=end]
        \fullframe{\animategraphics[autoplay,loop,width=\paperwidth]{#1}{sty/frames/frame-}{000}{124}}    
    \end{frame}
}


\ifavenir
  \setsansfont{AvenirNextLTPro}[
    Path = sty/fonts/,
    Extension = .otf,
    UprightFont = *-Regular,
    BoldFont = *-Demi,
    ItalicFont = *-Italic,
    BoldItalicFont = *-DemiItalic
  ]
\else
  \renewcommand*\familydefault{\sfdefault} 
\fi